strip.text.x = element_blank()) +
xlab(element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
combine = function(a,b,c,d = NULL, ref, filtered = NULL){
if (is.null(filtered) == T){
filtered = c("All", "Quarter Adaptive 95%",
"Quarter Adaptive 99%", "Quarter Shuffle 95%", "Shuffle 95%",
"Shuffle Weighted", "Static 0.60","Static 0.75", "Static 0.90", "LASSO 1SE", "LASSO MIN")
}
dimension = c("n = 20, p = 1000, active = 2",
"n = 100, p = 500, active = 10",
"n = 200, p = 200, active = 20",
"n = 500, p = 100, active = 20")
labels  = c("(I):~n==20*`,`~p==1000*`,`~`|`*beta[S]*`|`==2",
"(II):~n==100*`,`~p==500*`,`~`|`*beta[S]*`|`==10",
"(III):~n==200*`,`~p==200*`,`~`|`*beta[S]*`|`==20",
"(IV):~n==500*`,`~p==100*`,`~`|`*beta[S]*`|`==20")
SNR = c(0.5,1,2, 3)
SNRlabels = c("~SNR==0.5", "~SNR==1", "~SNR==2", "~SNR==3")
r = rbind(a |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[1], N = "A"),
b |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[2], N = "B"),
c |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[3], N = "C"),
d |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[4], N = "C"))
r$Method = as.character(r$Method)
r$Method[r$Method == "LASSO 1SE"] = "LASSO"
r$Method[r$Method == "Exclusion ATS"] = "EATS"
r$Method[r$Method == "All"] = "ATS"
r$Method = factor(r$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
r = data.frame(r) |> mutate(Dimension = dimension[ref]) |>
mutate(Dimension = factor(Dimension, labels = labels[ref]),
SNR = factor(SNR, levels = c("0.5", "1", "2", "3"),
labels = c(SNRlabels[1],
SNRlabels[2],
SNRlabels[3],
SNRlabels[4])))
return(r)
}
combineN = function(a,b,c = NULL,d, ref,filtered = NULL){
if (is.null(filtered) == T){
filtered = c("ATS", "Exclusion ATS", "Static 0.60","Static 0.75", "Static 0.90", "LASSO 1SE", "LASSO MIN")
}
dimension = c("n = 20, p = 1000, active = 2",
"n = 100, p = 500, active = 10",
"n = 200, p = 200, active = 20",
"n = 500, p = 100, active = 20")
labels  = c("(I):~n==20*`,`~p==1000*`,`~`|`*beta[S]*`|`==2",
"(II):~n==100*`,`~p==500*`,`~`|`*beta[S]*`|`==10",
"(III):~n==200*`,`~p==200*`,`~`|`*beta[S]*`|`==20",
"(IV):~n==500*`,`~p==100*`,`~`|`*beta[S]*`|`==20")
SNR = c(0.5,1,2, 3)
SNRlabels = c("~SNR==0.5", "~SNR==1", "~SNR==2", "~SNR==3")
r = rbind(a |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[1], N = "A"),
b |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[2], N = "B"),
c |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[3], N = "C"),
d |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[4], N = "C"))
r$Method = as.character(r$Method)
r$Method[r$Method == "LASSO 1SE"] = "LASSO"
r$Method[r$Method == "Exclusion ATS"] = "EATS"
r$Method[r$Method == "All"] = "ATS"
r$Method = factor(r$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
r = data.frame(r) |> mutate(Dimension = dimension[ref]) |>
mutate(Dimension = factor(Dimension, labels = labels[ref]),
SNR = factor(SNR, levels = c("0.5", "1", "2", "3"),
labels = c(SNRlabels[1],
SNRlabels[2],
SNRlabels[3],
SNRlabels[4])))
return(r)
}
totplotN = function(TOT, lim = max(TOT$NN)){
str = unique(TOT$Dimension) |> as.character() |> strsplit(split = "|")
active = numeric(length(str))
for (i in 1:length(str)){
if (str[[i]] |> last() == 0){
active[i] = paste(str[[i]] |> nth(-2), str[[i]] |> last(), sep = "") |> as.numeric()
}else{
active[i] = as.numeric(str[[i]] |> last())
}
}
TOTdummy = TOT |> group_by(Dimension) |> summarise(active = mean(NN))
TOTdummy$active = active
ggplot(TOT,aes(x = Method, y = NN, fill = Method)) + geom_boxplot(alpha = 0.65) +
facet_grid(Dimension ~SNR, labeller = label_parsed) +
ylab("Variables Selected") +
geom_hline(data = TOTdummy, aes(yintercept = active), linetype = "dashed", linewidth = 0.5) +
coord_cartesian(ylim = c(0, lim)) +
theme_few_grid(base_size = 20) +
xlab(element_blank()) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
totplotNnoaxis = function(TOT, lim = max(TOT$NN)){
str = unique(TOT$Dimension) |> as.character() |> strsplit(split = "|")
active = numeric(length(str))
for (i in 1:length(str)){
if (str[[i]] |> last() == 0){
active[i] = paste(str[[i]] |> nth(-2), str[[i]] |> last(), sep = "") |> as.numeric()
}else{
active[i] = as.numeric(str[[i]] |> last())
}
}
TOTdummy = TOT |> group_by(Dimension) |> summarise(active = mean(NN))
TOTdummy$active = active
ggplot(TOT,aes(x = Method, y = NN, fill = Method)) + geom_boxplot(alpha = 0.65) +
facet_grid(Dimension ~SNR, labeller = label_parsed) +
ylab("Variables Selected") +
geom_hline(data = TOTdummy, aes(yintercept = active), linetype = "dashed", linewidth = 0.5) +
coord_cartesian(ylim = c(0, lim)) +
theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x= element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
NtotMEANplotnoaxis = function(TOT, lim = max(TOT$NN), proDiab = F){
if (proDiab == T){text = c("SNR==1", "SNR==3")}
if (proDiab == F){text = c("SNR==0.5", "SNR==1", "SNR==2", "SNR==3")}
str = unique(TOT$Dimension) |> as.character() |> strsplit(split = "|")
active = numeric(length(str))
for (i in 1:length(str)){
if (str[[i]] |> last() == 0){
active[i] = paste(str[[i]] |> nth(-2), str[[i]] |> last(), sep = "") |> as.numeric()
}else{
active[i] = as.numeric(str[[i]] |> last())
}
}
TOTdummy = TOT |> group_by(Dimension) |> summarise(active = mean(NN))
TOTdummy$active = active
TOTm = TOT |> group_by(Method, SNR, Dimension) |>
summarise(mean = mean(NN), .groups = "drop")
ggplot(TOTm, aes(x = Method, y = mean, group = SNR)) +
geom_line(linetype = "solid", alpha = 0.3, linewidth = 0.5) +
ylab("Variables Selected") +
geom_hline(data = TOTdummy, aes(yintercept = active), linetype = "dashed", linewidth = 0.5) +
geom_point(aes(colour = Method, shape = SNR, fill = Method), size = 3, show.legend = TRUE) +
facet_grid(~Dimension, labeller = label_parsed) +
theme_few_grid(base_size = 20) +
theme(
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
legend.title = element_blank()  # removes legend title
) +
scale_shape_manual(
values = c(21,22,23,24),
labels = parse(text = text)  # parsed SNR labels
) +
scale_colour_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none") +  # hide colour legend
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none")  # hide fill legend
}
NtotMEANplot = function(TOT, lim = max(TOT$NN), proDiab = F){
if (proDiab == T){text = c("SNR==1", "SNR==3")}
if (proDiab == F){text = c("SNR==0.5", "SNR==1", "SNR==2", "SNR==3")}
str = unique(TOT$Dimension) |> as.character() |> strsplit(split = "|")
active = numeric(length(str))
for (i in 1:length(str)){
if (str[[i]] |> last() == 0){
active[i] = paste(str[[i]] |> nth(-2), str[[i]] |> last(), sep = "") |> as.numeric()
}else{
active[i] = as.numeric(str[[i]] |> last())
}
}
TOTdummy = TOT |> group_by(Dimension) |> summarise(active = mean(NN))
TOTdummy$active = active
TOTm = TOT |> group_by(Method, SNR, Dimension) |>
summarise(mean = mean(NN), .groups = "drop")
ggplot(TOTm, aes(x = Method, y = mean, group = SNR)) +
geom_line(linetype = "solid", alpha = 0.3, linewidth = 0.5) +
ylab("Variables Selected") +
geom_hline(data = TOTdummy, aes(yintercept = active), linetype = "dashed", linewidth = 0.5) +
geom_point(aes(colour = Method, shape = SNR, fill = Method), size = 3, show.legend = TRUE) +
facet_grid(~Dimension, labeller = label_parsed) +
theme_few_grid(base_size = 20) +
theme(
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
legend.title = element_blank()) +
scale_shape_manual(
values = c(21,22,23,24),
labels = parse(text = text)  # parsed SNR labels
) +
scale_colour_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none") +  # hide colour legend
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none")  # hide fill legend
}
totMEANplotnoaxis <- function(TOT, proDiab = F){
if (proDiab == T){text = c("SNR==1", "SNR==3")}
if (proDiab == F){text = c("SNR==0.5", "SNR==1", "SNR==2", "SNR==3")}
TOTm <- TOT |>
group_by(Method, SNR, Dimension) |>
summarise(mean = mean(MCC), .groups = "drop")
ggplot(TOTm, aes(x = Method, y = mean, group = SNR)) +
geom_line(linetype = "solid", alpha = 0.3, linewidth = 0.5) +
ylab("MCC") +
geom_point(aes(colour = Method, shape = SNR, fill = Method), size = 3, show.legend = TRUE) +
facet_grid(~Dimension, labeller = label_parsed) +
theme_few_grid(base_size = 20) +
theme(
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
legend.title = element_blank()  # removes legend title
) +
scale_shape_manual(
values = c(21,22,23,24),
labels = parse(text = text)  # parsed SNR labels
) +
scale_colour_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none") +  # hide colour legend
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none")  # hide fill legend
}
totMEANplot = function(TOT, stat, proDiab = F){
if (proDiab == T){text = c("SNR==1", "SNR==3")}
if (proDiab == F){text = c("SNR==0.5", "SNR==1", "SNR==2", "SNR==3")}
TOTm = TOT |> group_by(Method, SNR, Dimension) |> summarise(mean = mean(MCC))
ggplot(TOTm, aes(x = Method, y = mean, group = interaction(SNR))) +
geom_line(linetype = "solid", alpha = 0.3, linewidth = 0.5) +
ylab("MCC") +
geom_point(aes(colour = Method, shape = SNR, fill = Method), size = 3, show.legend = T) +
facet_grid(~Dimension, labeller = label_parsed) +
theme_few_grid(base_size = 20) +
theme(
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
legend.title = element_blank()) +
xlab(element_blank()) +
scale_shape_manual(
values = c(21,22,23,24),
labels = parse(text = text)  # parsed SNR labels
) +
scale_colour_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none") +  # hide colour legend
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"), guide = "none")  # hide fill legend
}
combineRecall = function(a,b,c = NULL,d, ref,filtered = NULL, ribo = F){
if (is.null(filtered) == T){
filtered = c("All", "Quarter Adaptive 95%",
"Quarter Adaptive 99%", "Quarter Shuffle 95%", "Shuffle 95%",
"Shuffle Weighted", "Static 0.60","Static 0.75", "Static 0.90", "LASSO 1SE", "LASSO MIN")
}
dimension = c("n = 20, p = 1000, active = 2",
"n = 100, p = 500, active = 10",
"n = 200, p = 200, active = 20",
"n = 500, p = 100, active = 20")
labels  = c("(I):~n==20*`,`~p==1000*`,`~`|`*beta[S]*`|`==2",
"(II):~n==100*`,`~p==500*`,`~`|`*beta[S]*`|`==10",
"(III):~n==200*`,`~p==200*`,`~`|`*beta[S]*`|`==20",
"(IV):~n==500*`,`~p==100*`,`~`|`*beta[S]*`|`==20")
SNR = c(0.5,1,2,3)
SNRlabels = c("~SNR==0.5", "~SNR==1", "~SNR==2", "~SNR==3")
r = rbind(a |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[1], N = "A"),
b |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[2], N = "B"),
c |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[3], N = "C"),
d |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[4], N = "C"))
r$Method = as.character(r$Method)
r$Method[r$Method == "LASSO 1SE"] = "LASSO"
r$Method[r$Method == "Exclusion ATS"] = "EATS"
r$Method[r$Method == "All"] = "ATS"
r$Method = factor(r$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
r = data.frame(r) |> mutate(Dimension = dimension[ref]) |>
mutate(Dimension = factor(Dimension, labels = labels[ref]),
SNR = factor(SNR, levels = c("0.5", "1", "2", "3"),
labels = c(SNRlabels[1],
SNRlabels[2],
SNRlabels[3],
SNRlabels[4])))
return(r)
}
totplotRecall = function(TOT){
ggplot(TOT,aes(x = Method, y = Recall, fill = Method)) + geom_boxplot() +
facet_grid(Dimension ~SNR, labeller = label_parsed, scales = "free_y") +
ylab("Recall") +
theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
combinePrecision = function(a,b,c = NULL,d, ref,filtered = NULL, ribo = F){
if (is.null(filtered) == T){
filtered = c("All", "Quarter Adaptive 95%",
"Quarter Adaptive 99%", "Quarter Shuffle 95%", "Shuffle 95%",
"Shuffle Weighted", "Static 0.60","Static 0.75", "Static 0.90", "LASSO 1SE", "LASSO MIN")
}
dimension = c("n = 20, p = 1000, active = 2",
"n = 100, p = 500, active = 10",
"n = 200, p = 200, active = 20",
"n = 500, p = 100, active = 20")
labels  = c("(I):~n==20*`,`~p==1000*`,`~`|`*beta[S]*`|`==2",
"(II):~n==100*`,`~p==500*`,`~`|`*beta[S]*`|`==10",
"(III):~n==200*`,`~p==200*`,`~`|`*beta[S]*`|`==20",
"(IV):~n==500*`,`~p==100*`,`~`|`*beta[S]*`|`==20")
SNR = c(0.5,1,2, 3)
SNRlabels = c("~SNR==0.5", "~SNR==1", "~SNR==2", "~SNR==3")
r = rbind(a |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[1], N = "A"),
b |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[2], N = "B"),
c |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[3], N = "C"),
d |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[4], N = "C"))
r$Method = as.character(r$Method)
r$Method[r$Method == "LASSO 1SE"] = "LASSO"
r$Method[r$Method == "Exclusion ATS"] = "EATS"
r$Method[r$Method == "All"] = "ATS"
r$Method = factor(r$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
r = data.frame(r) |> mutate(Dimension = dimension[ref]) |>
mutate(Dimension = factor(Dimension, labels = labels[ref]),
SNR = factor(SNR, levels = c("0.5", "1", "2", "3"),
labels = c(SNRlabels[1],
SNRlabels[2],
SNRlabels[3],
SNRlabels[4])))
return(r)
}
totplotPrecision = function(TOT){
ggplot(TOT,aes(x = Method, y = Precision, fill = Method)) + geom_boxplot() +
facet_wrap(Dimension ~SNR, labeller = label_parsed, ncol = 4) +
ylab("Recall") +
theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
prplot1 = function(recall, precision, recall1, precision1){
r = ggplot(recall, aes(x = Method, y = Recall, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Recall") + theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x= element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
p = ggplot(precision, aes(x = Method, y = Precision, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Precision") + theme_few_grid(base_size = 20) +
xlab(element_blank()) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_blank(),
strip.text.x = element_blank(),
axis.ticks.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
rr = ggplot(recall1, aes(x = Method, y = Recall, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Recall") + theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x= element_blank(),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
pp = ggplot(precision1, aes(x = Method, y = Precision, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Precision") + theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
library(patchwork)
r/p/rr/pp
}
### FDR Function ###
fdr = function(X, p, beta, snr, EV, LOOPS = 1000){
n.selected = false.selections = correct.selections.prop = method = pi = c()
for (i in 1:LOOPS){
signal = sqrt(mean((as.matrix(X) %*% as.matrix(beta))^2))
sigma = as.numeric(signal/sqrt(snr))
# Compute Y with SNR
Y = as.matrix(X)%*%as.matrix(beta) + rnorm(nrow(X), 0, sd = sigma)
# Stability Selection
s = stabs::stabsel(x = X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
# Shuffle data
idx = sample(1:nrow(X), replace = F)
rX = X[idx,]
idxPushed = c(tail(idx, 1), head(idx, -1))
rY = Y[idxPushed] |> as.matrix(ncol = 1)
# Exclusion Probability Threshold
sMix = stabs::stabsel(x = rX, y = rY, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
sMix_prob = sort(sMix$max, decreasing = T)
mix_exclusion = quantile(sMix_prob, 0.95)
EATS =  convert(s)[1:(length(convert(s)))][convert(s)[1:(length(convert(s)))] >= 100*mix_exclusion]
if (length(EATS) == 2){EATS = c(EATS, EATS[1])}
EATSix = EATS |> getR()
pi.hat = EATS[EATSix]/100
if (pi.hat <= 0.5){
s = stabs::stabsel(x = X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = EV, cutoff = 0.501,
sampling.type = "MB")
}else{
s = stabs::stabsel(x = X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = EV, cutoff = pi.hat,
sampling.type = "MB")
}
n.selected[i] = length(s$selected)
false.selections[i] = sum(!(s$selected %in% 1:active))
correct.selections.prop[i] = sum((s$selected %in% 1:active))/active
pi[i] = pi.hat
method[i] = ifelse(pi.hat < 0.5, "CPSS", "SS")
if (i %% 10 == 0){print(i)}
}
out = data.frame(n.selected,false.selections, correct.selections.prop, method, pi, EV, snr)
}
((totMEANplotnoaxis(pro9) | totMEANplotnoaxis(pro4)) +  plot_layout(axis_titles = "collect", guides = "collect")) / ((NtotMEANplot(pro9N) + theme(legend.position = "none") | NtotMEANplot(pro4N)) + theme(legend.position = "none") +  plot_layout(guides = "collect", axis_titles = "collect"))
((totMEANplotnoaxis(pro9, proDiab = T) | totMEANplotnoaxis(pro4, proDiab = T)) +  plot_layout(axis_titles = "collect", guides = "collect")) / ((NtotMEANplot(pro9N, proDiab = T) + theme(legend.position = "none") | NtotMEANplot(pro4N, proDiab = T)) + theme(legend.position = "none") +  plot_layout(guides = "collect", axis_titles = "collect"))
load("Data/S1.Rdata")
load("Data/S2.Rdata")
load("Data/S3.Rdata")
load("Data/S4.Rdata")
#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--
# Figures
#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--
# MCC
c11hard = combine(S1.05hard, S1.1hard, S1.2hard, S1.3hard,  1, filtered = filtered) |> makeCluster()
c22hard = combine(S2.05hard, S2.1hard, S2.2hard, S2.3hard,  2, filtered = filtered) |> makeCluster()
c33hard = combine(S3.05hard, S3.1hard, S3.2hard, S3.3hard,  3, filtered = filtered) |> makeCluster()
c44hard = combine(S4.05hard, S4.1hard, S4.2hard, S4.3hard,  4, filtered = filtered) |> makeCluster()
c1hardM = rbind(c11hard,c22hard) |> totMEANplotnoaxis()
c2hardM = rbind(c33hard,c44hard) |> totMEANplot()
# c1hard/c2hard
# 14/10
c1hardM/c2hardM + plot_layout(guides = "collect", axis_titles = "collect")
c1hardM = rbind(c11hard,c22hard) |> totMEANplotnoaxis(proDiab = T)
c1hardM
((totMEANplotnoaxis(pro9, proDiab = T) | totMEANplotnoaxis(pro4, proDiab = T)) +  plot_layout(axis_titles = "collect", guides = "collect")) / ((NtotMEANplot(pro9N, proDiab = T) + theme(legend.position = "none") | NtotMEANplot(pro4N, proDiab = T)) + theme(legend.position = "none") +  plot_layout(guides = "collect", axis_titles = "collect"))
load("Data/d10.Rdata")
load("Data/d5.Rdata")
#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--
# Figures
#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--#--
# MCC
d5.1.df = d5.1 |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==1")
d5.3.df = d5.3 |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==3")
d5 = rbind(d5.1.df,d5.3.df) |> mutate(SNR = factor(SNR, levels = c("~SNR==1", "~SNR==3")))
d5$Method = as.character(d5$Method)
d5$Method[d5$Method == "LASSO 1SE"] = "LASSO"
d5$Method[d5$Method == "Exclusion ATS"] = "EATS"
d5$Method = factor(d5$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
d5 = data.frame(d5) |> mutate(Dimension = "n==442*`,`~p==64*`,`~`|`*beta[S]*`|`==5") |>
mutate(Dimension = factor(Dimension)) |> makeCluster()
d10.1.df = d10.1 |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==1")
d10.3.df = d10.3 |> cleanMCC() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==3")
d10 = rbind(d10.1.df,d10.3.df)|> mutate(SNR = factor(SNR, levels = c("~SNR==1", "~SNR==3")))
d10$Method = as.character(d5$Method)
d10$Method[d10$Method == "LASSO 1SE"] = "LASSO"
d10$Method[d10$Method == "Exclusion ATS"] = "EATS"
d10$Method = factor(d10$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
d10 = data.frame(d10) |> mutate(Dimension = "n==442*`,`~p==64*`,`~`|`*beta[S]*`|`==10") |>
mutate(Dimension = factor(Dimension)) |> makeCluster()
# d5plot = ggplot(d5,aes(x = Method, y = MCC, fill = Method)) + geom_boxplot(alpha = 0.65) +
#   facet_grid(Dimension ~SNR, labeller = label_parsed) +
#   theme_few_grid(base_size = 20) +
#   stat_summary(fun ="mean", shape = 5, size = 0.5) +
#   xlab(element_blank()) +
#   stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
#   theme(legend.position = "none",
#         axis.title.x=element_blank(),
#         axis.text.x=element_blank(),
#         axis.ticks.x= element_blank(),
#         strip.text.x = element_blank()) +
#   scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
#
# d10plot = ggplot(d10,aes(x = Method, y = MCC, fill = Method)) + geom_boxplot(alpha = 0.65) +
#   facet_grid(Dimension ~SNR, labeller = label_parsed) +
#   theme_few_grid(base_size = 20) +
#   xlab(element_blank()) +
#   stat_summary(fun ="mean", shape = 5, size = 0.5) +
#   stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
#   theme(legend.position = "none",
#         axis.title.x=element_blank(),
#         axis.text.x=element_blank(),
#         axis.ticks.x= element_blank()) +
#   scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
#---#---#---#---#---#---#---#---#---#---#---#---#---#---
# Variables Selected
d5.1.df.N = d5.1 |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==1")
d5.3.df.N = d5.3 |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==3")
d5N = rbind(d5.1.df.N,d5.3.df.N)|> mutate(SNR = factor(SNR, levels = c("~SNR==1", "~SNR==3")))
d5N$Method = as.character(d5N$Method)
d5N$Method[d5N$Method == "LASSO 1SE"] = "LASSO"
d5N$Method[d5N$Method == "Exclusion ATS"] = "EATS"
d5N$Method[d5N$Method == "All"] = "ATS"
d5N$Method = factor(d5N$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
d5N = data.frame(d5N) |> mutate(Dimension = "n==442*`,`~p==64*`,`~`|`*beta[S]*`|`==5") |>
mutate(Dimension = factor(Dimension)) |> makeCluster()
d10.1.df.N = d10.1 |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==1")
d10.3.df.N = d10.3 |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = "~SNR==3")
d10N = rbind(d10.1.df.N,d10.3.df.N)|> mutate(SNR = factor(SNR, levels = c("~SNR==1", "~SNR==3")))
d10N$Method = as.character(d5N$Method)
d10N$Method[d10N$Method == "LASSO 1SE"] = "LASSO"
d10N$Method[d10N$Method == "Exclusion ATS"] = "EATS"
d10N$Method[d10N$Method == "All"] = "ATS"
d10N$Method = factor(d10N$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
d10N = data.frame(d10N) |> mutate(Dimension = "n==442*`,`~p==64*`,`~`|`*beta[S]*`|`==10") |>
mutate(Dimension = factor(Dimension)) |> makeCluster()
# 14/10
((totMEANplotnoaxis(d10, proDiab = T) | totMEANplotnoaxis(d5, proDiab = T)) +  plot_layout(axis_titles = "collect", guides = "collect")) / ((NtotMEANplot(d10N, proDiab = T) + theme(legend.position = "none") | NtotMEANplot(d5N, proDiab = T)) + theme(legend.position = "none") +  plot_layout(guides = "collect", axis_titles = "collect"))
