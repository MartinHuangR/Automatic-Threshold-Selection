"(III):~n==200*`,`~p==200*`,`~`|`*beta[S]*`|`==20",
"(IV):~n==500*`,`~p==100*`,`~`|`*beta[S]*`|`==20")
SNR = c(0.5,1,2, 3)
SNRlabels = c("~SNR==0.5", "~SNR==1", "~SNR==2", "~SNR==3")
r = rbind(a |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[1], N = "A"),
b |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[2], N = "B"),
c |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[3], N = "C"),
d |> cleanN() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[4], N = "C"))
r$Method = as.character(r$Method)
r$Method[r$Method == "LASSO 1SE"] = "LASSO"
r$Method[r$Method == "Exclusion ATS"] = "EATS"
r$Method[r$Method == "All"] = "ATS"
r$Method = factor(r$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
r = data.frame(r) |> mutate(Dimension = dimension[ref]) |>
mutate(Dimension = factor(Dimension, labels = labels[ref]),
SNR = factor(SNR, levels = c("0.5", "1", "2", "3"),
labels = c(SNRlabels[1],
SNRlabels[2],
SNRlabels[3],
SNRlabels[4])))
return(r)
}
totplotN = function(TOT, lim = max(TOT$NN)){
str = unique(TOT$Dimension) |> as.character() |> strsplit(split = "|")
active = numeric(length(str))
for (i in 1:length(str)){
if (str[[i]] |> last() == 0){
active[i] = paste(str[[i]] |> nth(-2), str[[i]] |> last(), sep = "") |> as.numeric()
}else{
active[i] = as.numeric(str[[i]] |> last())
}
}
TOTdummy = TOT |> group_by(Dimension) |> summarise(active = mean(NN))
TOTdummy$active = active
ggplot(TOT,aes(x = Method, y = NN, fill = Method)) + geom_boxplot(alpha = 0.65) +
facet_grid(Dimension ~SNR, labeller = label_parsed) +
ylab("Variables Selected") +
geom_hline(data = TOTdummy, aes(yintercept = active), linetype = "dashed", linewidth = 0.5) +
coord_cartesian(ylim = c(0, lim)) +
theme_few_grid(base_size = 20) +
xlab(element_blank()) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
totplotNnoaxis = function(TOT, lim = max(TOT$NN)){
str = unique(TOT$Dimension) |> as.character() |> strsplit(split = "|")
active = numeric(length(str))
for (i in 1:length(str)){
if (str[[i]] |> last() == 0){
active[i] = paste(str[[i]] |> nth(-2), str[[i]] |> last(), sep = "") |> as.numeric()
}else{
active[i] = as.numeric(str[[i]] |> last())
}
}
TOTdummy = TOT |> group_by(Dimension) |> summarise(active = mean(NN))
TOTdummy$active = active
ggplot(TOT,aes(x = Method, y = NN, fill = Method)) + geom_boxplot(alpha = 0.65) +
facet_grid(Dimension ~SNR, labeller = label_parsed) +
ylab("Variables Selected") +
geom_hline(data = TOTdummy, aes(yintercept = active), linetype = "dashed", linewidth = 0.5) +
coord_cartesian(ylim = c(0, lim)) +
theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x= element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
combineRecall = function(a,b,c = NULL,d, ref,filtered = NULL, ribo = F){
if (is.null(filtered) == T){
filtered = c("All", "Quarter Adaptive 95%",
"Quarter Adaptive 99%", "Quarter Shuffle 95%", "Shuffle 95%",
"Shuffle Weighted", "Static 0.60","Static 0.75", "Static 0.90", "LASSO 1SE", "LASSO MIN")
}
dimension = c("n = 20, p = 1000, active = 2",
"n = 100, p = 500, active = 10",
"n = 200, p = 200, active = 20",
"n = 500, p = 100, active = 20")
labels  = c("(I):~n==20*`,`~p==1000*`,`~`|`*beta[S]*`|`==2",
"(II):~n==100*`,`~p==500*`,`~`|`*beta[S]*`|`==10",
"(III):~n==200*`,`~p==200*`,`~`|`*beta[S]*`|`==20",
"(IV):~n==500*`,`~p==100*`,`~`|`*beta[S]*`|`==20")
SNR = c(0.5,1,2,3)
SNRlabels = c("~SNR==0.5", "~SNR==1", "~SNR==2", "~SNR==3")
r = rbind(a |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[1], N = "A"),
b |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[2], N = "B"),
c |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[3], N = "C"),
d |> cleanRecall() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[4], N = "C"))
r$Method = as.character(r$Method)
r$Method[r$Method == "LASSO 1SE"] = "LASSO"
r$Method[r$Method == "Exclusion ATS"] = "EATS"
r$Method[r$Method == "All"] = "ATS"
r$Method = factor(r$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
r = data.frame(r) |> mutate(Dimension = dimension[ref]) |>
mutate(Dimension = factor(Dimension, labels = labels[ref]),
SNR = factor(SNR, levels = c("0.5", "1", "2", "3"),
labels = c(SNRlabels[1],
SNRlabels[2],
SNRlabels[3],
SNRlabels[4])))
return(r)
}
totplotRecall = function(TOT){
ggplot(TOT,aes(x = Method, y = Recall, fill = Method)) + geom_boxplot() +
facet_grid(Dimension ~SNR, labeller = label_parsed, scales = "free_y") +
ylab("Recall") +
theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
combinePrecision = function(a,b,c = NULL,d, ref,filtered = NULL, ribo = F){
if (is.null(filtered) == T){
filtered = c("All", "Quarter Adaptive 95%",
"Quarter Adaptive 99%", "Quarter Shuffle 95%", "Shuffle 95%",
"Shuffle Weighted", "Static 0.60","Static 0.75", "Static 0.90", "LASSO 1SE", "LASSO MIN")
}
dimension = c("n = 20, p = 1000, active = 2",
"n = 100, p = 500, active = 10",
"n = 200, p = 200, active = 20",
"n = 500, p = 100, active = 20")
labels  = c("(I):~n==20*`,`~p==1000*`,`~`|`*beta[S]*`|`==2",
"(II):~n==100*`,`~p==500*`,`~`|`*beta[S]*`|`==10",
"(III):~n==200*`,`~p==200*`,`~`|`*beta[S]*`|`==20",
"(IV):~n==500*`,`~p==100*`,`~`|`*beta[S]*`|`==20")
SNR = c(0.5,1,2, 3)
SNRlabels = c("~SNR==0.5", "~SNR==1", "~SNR==2", "~SNR==3")
r = rbind(a |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[1], N = "A"),
b |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[2], N = "B"),
c |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[3], N = "C"),
d |> cleanPrecision() |> dplyr::filter(Method %in% filtered) |> mutate(SNR = SNR[4], N = "C"))
r$Method = as.character(r$Method)
r$Method[r$Method == "LASSO 1SE"] = "LASSO"
r$Method[r$Method == "Exclusion ATS"] = "EATS"
r$Method[r$Method == "All"] = "ATS"
r$Method = factor(r$Method, levels = c("ATS", "EATS", "Static 0.60", "Static 0.75", "Static 0.90", "LASSO","Knockoff","SCAD"))
r = data.frame(r) |> mutate(Dimension = dimension[ref]) |>
mutate(Dimension = factor(Dimension, labels = labels[ref]),
SNR = factor(SNR, levels = c("0.5", "1", "2", "3"),
labels = c(SNRlabels[1],
SNRlabels[2],
SNRlabels[3],
SNRlabels[4])))
return(r)
}
totplotPrecision = function(TOT){
ggplot(TOT,aes(x = Method, y = Precision, fill = Method)) + geom_boxplot() +
facet_wrap(Dimension ~SNR, labeller = label_parsed, ncol = 4) +
ylab("Recall") +
theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
}
prplot1 = function(recall, precision, recall1, precision1){
r = ggplot(recall, aes(x = Method, y = Recall, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Recall") + theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x= element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
p = ggplot(precision, aes(x = Method, y = Precision, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Precision") + theme_few_grid(base_size = 20) +
xlab(element_blank()) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_blank(),
strip.text.x = element_blank(),
axis.ticks.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
rr = ggplot(recall1, aes(x = Method, y = Recall, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Recall") + theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x= element_blank(),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
pp = ggplot(precision1, aes(x = Method, y = Precision, fill = Method)) +
geom_boxplot() + facet_grid(Dimension~SNR, labeller = label_parsed) +
ylab("Precision") + theme_few_grid(base_size = 20) +
stat_summary(fun ="mean", shape = 5, size = 0.5) +
stat_summary(fun= "mean", geom="line", linetype ="solid", linewidth = 0.5,  aes(group= cluster, alpha = 2)) +
theme(legend.position = "none",
axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
strip.text.x = element_blank()) +
scale_fill_manual(values = c("#FC8D62", "#FFD92F","#A6D854","#A6D854","#A6D854","#8DA0CB","#8DA0CB","#8DA0CB"))
library(patchwork)
r/p/rr/pp
}
### FDR Function ###
fdr = function(X, p, beta, snr, EV, LOOPS = 1000){
n.selected = false.selections = correct.selections.prop = method = pi = c()
for (i in 1:LOOPS){
signal = sqrt(mean((as.matrix(X) %*% as.matrix(beta))^2))
sigma = as.numeric(signal/sqrt(snr))
# Compute Y with SNR
Y = as.matrix(X)%*%as.matrix(beta) + rnorm(nrow(X), 0, sd = sigma)
# Stability Selection
s = stabs::stabsel(x = X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
# Shuffle data
idx = sample(1:nrow(X), replace = F)
rX = X[idx,]
idxPushed = c(tail(idx, 1), head(idx, -1))
rY = Y[idxPushed] |> as.matrix(ncol = 1)
# Exclusion Probability Threshold
sMix = stabs::stabsel(x = rX, y = rY, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
sMix_prob = sort(sMix$max, decreasing = T)
mix_exclusion = quantile(sMix_prob, 0.95)
EATS =  convert(s)[1:(length(convert(s)))][convert(s)[1:(length(convert(s)))] >= 100*mix_exclusion]
if (length(EATS) == 2){EATS = c(EATS, EATS[1])}
EATSix = EATS |> getR()
pi.hat = EATS[EATSix]/100
if (pi.hat <= 0.5){
s = stabs::stabsel(x = X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = EV, cutoff = 0.501,
sampling.type = "MB")
}else{
s = stabs::stabsel(x = X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = EV, cutoff = pi.hat,
sampling.type = "MB")
}
n.selected[i] = length(s$selected)
false.selections[i] = sum(!(s$selected %in% 1:active))
correct.selections.prop[i] = sum((s$selected %in% 1:active))/active
pi[i] = pi.hat
method[i] = ifelse(pi.hat < 0.5, "CPSS", "SS")
if (i %% 10 == 0){print(i)}
}
out = data.frame(n.selected,false.selections, correct.selections.prop, method, pi, EV, snr)
}
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2
library(patchwork)
e2[[1]] + e2[[2]]
e2[[2]] + e2[[1]]
plot_elbow = function(n, p, active, snr = 3, LQ = F, upto = min(p, 30), true){
d = gendata(n = n, p = p, active = active)
signal = sqrt(mean((as.matrix(d$X) %*% as.matrix(d$beta))^2))
sigma = as.numeric(signal/sqrt(snr))
# Compute Y with SNR
Y = as.matrix(d$X)%*%as.matrix(d$beta) + rnorm(nrow(d$X), 0, sd = sigma)
s = stabs::stabsel(x = d$X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
idx = sample(1:nrow(d$X), replace = F)
rX = d$X[idx,]
idxPushed = c(tail(idx, 1), head(idx, -1))
rY = Y[idxPushed] |> as.matrix(ncol = 1)
# Exclusion Probability Threshold
sMix = stabs::stabsel(x = rX, y = rY, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
sMix_prob = sort(sMix$max, decreasing = T)
mix_exclusion = quantile(sMix_prob, 0.95)
EATS =  convert(s)[1:(length(convert(s)))][convert(s)[1:(length(convert(s)))] >= 100*mix_exclusion]
EATS = EATS |> getR()
df1 = data.frame(sel.prob = s$max, vnames = factor(names(s$max), levels = names(s$max)))
lq1 = data.frame(LQ = getLQ(convert(s)), vnames = factor(names(s$max), levels = names(s$max)))
p1 = ggplot(lq1[1:upto,], aes(x = vnames, y = LQ)) + geom_line(group = 1) + theme_few_grid(base_size = 20) +
labs(x = "Variable Name", y = "Likelihood") + geom_vline(xintercept = which.max(lq1$LQ), linetype = "dashed") +
theme(axis.text.x = element_blank())
p2 = ggplot(df1[1:upto, ], aes(x = reorder(vnames, sel.prob, decreasing = TRUE), y = sel.prob)) +
geom_line(group = 1, color = "black") +
geom_point(aes(shape = sel.prob >= sort(sel.prob, decreasing = TRUE)[EATS],
colour = vnames %in% names(d$beta)[1:active],
fill = vnames %in% names(d$beta)[1:active]), size = 5, stroke = 1) +
geom_vline(xintercept = EATS, linetype = "dashed") +
labs(x = "Variable Name", y = "Selection Probability") +
scale_color_manual(name = "Truth",
labels = c("TRUE" = "Signal", "FALSE" = "Noise"),
values = c("TRUE" = "red", "FALSE" = "black")) +
scale_fill_manual(name = "Truth",
labels = c("TRUE" = "Signal", "FALSE" = "Noise"),
values = c("TRUE" = "red", "FALSE" = "black")) +
scale_shape_manual(name = "EATS-Selected",
labels = c("TRUE" = "Yes", "FALSE" = "No"),
values = c("TRUE" = 1, "FALSE" = 13)) +
theme_few_grid(base_size = 20) +
theme(axis.text.x = element_blank(), legend.position = "none")
list(p1,p2)
}
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(2)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(2)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(3)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(4)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(5)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(6)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(7)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(8)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(9)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(10)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(11)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(12)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(13)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(14)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(15)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(16)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(17)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(18)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(19)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(20)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(21)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(22)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(23)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(24)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(25)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(26)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(27)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(28)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(29)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(30)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
# 22 is good.
set.seed(31)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(32)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(100)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(1000)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
# 22 is good.
set.seed(22)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
plot_elbow = function(n, p, active, snr = 3, LQ = F, upto = min(p, 30), true){
d = gendata(n = n, p = p, active = active)
signal = sqrt(mean((as.matrix(d$X) %*% as.matrix(d$beta))^2))
sigma = as.numeric(signal/sqrt(snr))
# Compute Y with SNR
Y = as.matrix(d$X)%*%as.matrix(d$beta) + rnorm(nrow(d$X), 0, sd = sigma)
s = stabs::stabsel(x = d$X, y = Y, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
idx = sample(1:nrow(d$X), replace = F)
rX = d$X[idx,]
idxPushed = c(tail(idx, 1), head(idx, -1))
rY = Y[idxPushed] |> as.matrix(ncol = 1)
# Exclusion Probability Threshold
sMix = stabs::stabsel(x = rX, y = rY, B = 100,
fitfun = stabs::lars.lasso, PFER = 5, cutoff = 0.75,
sampling.type = "MB")
sMix_prob = sort(sMix$max, decreasing = T)
mix_exclusion = quantile(sMix_prob, 0.95)
EATS =  convert(s)[1:(length(convert(s)))][convert(s)[1:(length(convert(s)))] >= 100*mix_exclusion]
EATS = EATS |> getR()
df1 = data.frame(sel.prob = s$max, vnames = factor(names(s$max), levels = names(s$max)))
lq1 = data.frame(LQ = getLQ(convert(s)), vnames = factor(names(s$max), levels = names(s$max)))
p1 = ggplot(lq1[1:upto,], aes(x = vnames, y = LQ)) + geom_line(group = 1) + theme_few_grid(base_size = 20) +
labs(x = "Variable Name", y = "Likelihood") + geom_vline(xintercept = which.max(lq1$LQ), linetype = "dashed") +
theme(axis.text.x = element_blank())
p2 = ggplot(df1[1:upto, ], aes(x = reorder(vnames, sel.prob, decreasing = TRUE), y = sel.prob)) +
geom_line(group = 1, color = "black") +
geom_point(aes(shape = sel.prob >= sort(sel.prob, decreasing = TRUE)[EATS],
colour = vnames %in% names(d$beta)[1:active],
fill = vnames %in% names(d$beta)[1:active]), size = 8, stroke = 1) +
geom_vline(xintercept = EATS, linetype = "dashed") +
labs(x = "Variable Name", y = "Selection Probability") +
scale_color_manual(name = "Truth",
labels = c("TRUE" = "Signal", "FALSE" = "Noise"),
values = c("TRUE" = "red", "FALSE" = "black")) +
scale_fill_manual(name = "Truth",
labels = c("TRUE" = "Signal", "FALSE" = "Noise"),
values = c("TRUE" = "red", "FALSE" = "black")) +
scale_shape_manual(name = "EATS-Selected",
labels = c("TRUE" = "Yes", "FALSE" = "No"),
values = c("TRUE" = 1, "FALSE" = 13)) +
theme_few_grid(base_size = 20) +
theme(axis.text.x = element_blank(), legend.position = "none")
list(p1,p2)
}
# 22 is good.
set.seed(22)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
# 22 is good.
set.seed(1)
n = 100; p = 500; active = 10
e2 = plot_elbow(n,p,active)
e2[[2]] + e2[[1]]
set.seed(1)
n = 500; p = 100; active = 20
e4 = plot_elbow(n,p,active)
e4[[2]] + e4[[1]]
